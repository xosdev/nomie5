var O=(c,t,e)=>new Promise((s,r)=>{var n=o=>{try{l(e.next(o))}catch(f){r(f)}},a=o=>{try{l(e.throw(o))}catch(f){r(f)}},l=o=>o.done?s(o.value):Promise.resolve(o.value).then(n,a);l((e=e.apply(c,t)).next())});import{d as E,S as z,y as P,z as q,bz as G,a9 as D,aa as w,ab as Y,T as h,Y as g,ad as y,a2 as W,a1 as j,O as b,X as tt,Z as et,I as p,B as v,A as I,bw as x,F as k,H as S,C as M,bx as C,J as $,P as d,Q as B,al as rt,ag as L,bZ as A,by as st,bu as at}from"./vendor.36439469.js";import{c as J,w as nt,n as lt,a4 as ot,U as ct,L as it,a as Z,i as ut,I as U,t as F,a5 as ft,a3 as pt,d as V,j as N,e as $t,o as mt,h as dt}from"./index.35142b07.js";import{e as _t}from"./export-helper.f2e9b2fa.js";class ht{constructor(){}logsToCSV(t,e){let r=[["epoch","start","end","offset","tracker","value","note","lat","lng","location","score"]],n=e.map(a=>a.tag);return t.forEach(a=>{const l=(a.offset||new Date().getTimezoneOffset())*6e4,o=new Date(a.start-l).toISOString().slice(0,-1),f=new Date(a.end-l).toISOString().slice(0,-1);a.trackers.forEach(i=>{let u=i.id;n.indexOf(u)>-1&&r.push([a.end,o,f,a.offset,u,i.value,(a.note||"").replace(/(\"|\,|\n|\r)/g," "),a.lat,a.lng,`${a.location||""}`.replace(/(\"|\,|\n|\r)/g," "),a.score])}),a.trackers.length||r.push([a.end,o,f,a.offset,"note",1,a.note.replace(/(\"|\,|\n|\r)/g," "),a.lat,a.lng,`${a.location||""}`.replace(/(\"|\,|\n|\r)/g," "),a.score])}),r}generate(t){return O(this,null,function*(){t=t||{};let e=t.start,s=t.end,r=t.trackers;r.map(o=>typeof o=="string"?new J({tag:o}):new J(o));let n=yield nt.query({start:E(e).startOf("day"),end:E(s).endOf("day")});n=n.map(o=>(o.getMeta(),o));let a=this.logsToCSV(n,r),l=`n-${E(e).format("YYYY-MM-DD")}-${E(s).format("YYYY-MM-DD")}.${lt(6)}.6.0.0.csv`;ot.csv(l,a.join(`\r
`))})}}function gt(c){function t(){return O(this,null,function*(){yield ct.mstore("csv_exports")})}return G(t),[]}class bt extends z{constructor(t){super();P(this,t,gt,null,q,{})}}function H(c,t,e){const s=c.slice();return s[11]=t[e],s}function vt(c){let t,e,s,r,n;return e=new ft({props:{gap:4}}),r=new pt({props:{title:V.t("export.export-date","Generate Nomie Backup"),description:V.t("export.backup-description","Create an importable backup file. This allows you to transfer your data from one device to another using a single file (JSON) that contains ALL your Nomie data. Make sure to save it to your device."),emoji:"\u{1F4E6}",buttonLabel:V.t("export.backup-download","Download Backup"),buttonClick:c[4].export}}),{c(){t=v("div"),D(e.$$.fragment),s=I(),D(r.$$.fragment),this.h()},l(a){t=k(a,"DIV",{class:!0});var l=S(t);w(e.$$.fragment,l),s=M(l),w(r.$$.fragment,l),l.forEach(p),this.h()},h(){$(t,"class","backup")},m(a,l){b(a,t,l),Y(e,t,null),d(t,s),Y(r,t,null),n=!0},p:L,i(a){n||(h(e.$$.fragment,a),h(r.$$.fragment,a),n=!0)},o(a){g(e.$$.fragment,a),g(r.$$.fragment,a),n=!1},d(a){a&&p(t),y(e),y(r)}}}function kt(c){let t,e,s,r,n,a,l,o,f;return e=new bt({}),r=new N({props:{className:"mx-2 bg-transparent",$$slots:{default:[wt]},$$scope:{ctx:c}}}),a=new $t({props:{solo:!0,className:"pt-2",$$slots:{default:[It]},$$scope:{ctx:c}}}),o=new N({props:{title:V.t("export.csv-download","Download CSV..."),className:"text-primary-bright clickable solo mt-3",disabled:c[2],$$slots:{right:[Mt]},$$scope:{ctx:c}}}),o.$on("click",c[4].exportCSV),{c(){t=v("div"),D(e.$$.fragment),s=I(),D(r.$$.fragment),n=I(),D(a.$$.fragment),l=I(),D(o.$$.fragment),this.h()},l(i){t=k(i,"DIV",{class:!0});var u=S(t);w(e.$$.fragment,u),s=M(u),w(r.$$.fragment,u),n=M(u),w(a.$$.fragment,u),l=M(u),w(o.$$.fragment,u),u.forEach(p),this.h()},h(){$(t,"class","csv")},m(i,u){b(i,t,u),Y(e,t,null),d(t,s),Y(r,t,null),d(t,n),Y(a,t,null),d(t,l),Y(o,t,null),f=!0},p(i,u){const m={};u&16384&&(m.$$scope={dirty:u,ctx:i}),r.$set(m);const T={};u&16394&&(T.$$scope={dirty:u,ctx:i}),a.$set(T);const _={};u&4&&(_.disabled=i[2]),u&16384&&(_.$$scope={dirty:u,ctx:i}),o.$set(_)},i(i){f||(h(e.$$.fragment,i),h(r.$$.fragment,i),h(a.$$.fragment,i),h(o.$$.fragment,i),f=!0)},o(i){g(e.$$.fragment,i),g(r.$$.fragment,i),g(a.$$.fragment,i),g(o.$$.fragment,i),f=!1},d(i){i&&p(t),y(e),y(r),y(a),y(o)}}}function Dt(c){let t=V.t("export.csv-description","Export individual tracker data to CSV. Only one year at a time is supported.")+"",e;return{c(){e=x(t)},l(s){e=C(s,t)},m(s,r){b(s,e,r)},p:L,d(s){s&&p(e)}}}function wt(c){let t,e;return t=new mt({props:{class:"text-sm",$$slots:{default:[Dt]},$$scope:{ctx:c}}}),{c(){D(t.$$.fragment)},l(s){w(t.$$.fragment,s)},m(s,r){Y(t,s,r),e=!0},p(s,r){const n={};r&16384&&(n.$$scope={dirty:r,ctx:s}),t.$set(n)},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){g(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function Yt(c){let t,e=c[1].trackers,s=[];for(let r=0;r<e.length;r+=1)s[r]=Q(H(c,e,r));return{c(){for(let r=0;r<s.length;r+=1)s[r].c();t=j()},l(r){for(let n=0;n<s.length;n+=1)s[n].l(r);t=j()},m(r,n){for(let a=0;a<s.length;a+=1)s[a].m(r,n);b(r,t,n)},p(r,n){if(n&2){e=r[1].trackers;let a;for(a=0;a<e.length;a+=1){const l=H(r,e,a);s[a]?s[a].p(l,n):(s[a]=Q(l),s[a].c(),s[a].m(t.parentNode,t))}for(;a<s.length;a+=1)s[a].d(1);s.length=e.length}},d(r){at(s,r),r&&p(t)}}}function yt(c){let t,e=V.t("general.all-trackers","All Trackers")+"",s;return{c(){t=v("div"),s=x(e),this.h()},l(r){t=k(r,"DIV",{class:!0});var n=S(t);s=C(n,e),n.forEach(p),this.h()},h(){$(t,"class","text-primary")},m(r,n){b(r,t,n),d(t,s)},p:L,d(r){r&&p(t)}}}function Q(c){let t=c[11].emoji+"",e;return{c(){e=x(t)},l(s){e=C(s,t)},m(s,r){b(s,e,r)},p(s,r){r&2&&t!==(t=s[11].emoji+"")&&st(e,t)},d(s){s&&p(e)}}}function St(c){let t,e;function s(a,l){return(e==null||l&10)&&(e=a[1].trackers.length==Object.keys(a[3].trackers).length),e?yt:Yt}let r=s(c,-1),n=r(c);return{c(){t=v("div"),n.c(),this.h()},l(a){t=k(a,"DIV",{slot:!0});var l=S(t);n.l(l),l.forEach(p),this.h()},h(){$(t,"slot","right")},m(a,l){b(a,t,l),n.m(t,null)},p(a,l){r===(r=s(a,l))&&n?n.p(a,l):(n.d(1),n=r(a),n&&(n.c(),n.m(t,null)))},d(a){a&&p(t),n.d()}}}function Tt(c){let t,e,s;return{c(){t=v("input"),this.h()},l(r){t=k(r,"INPUT",{type:!0,class:!0,slot:!0}),this.h()},h(){$(t,"type","date"),$(t,"class","form-control"),$(t,"slot","right")},m(r,n){b(r,t,n),A(t,c[1].start),e||(s=B(t,"input",c[9]),e=!0)},p(r,n){n&2&&A(t,r[1].start)},d(r){r&&p(t),e=!1,s()}}}function Et(c){let t,e,s;return{c(){t=v("input"),this.h()},l(r){t=k(r,"INPUT",{type:!0,class:!0,slot:!0}),this.h()},h(){$(t,"type","date"),$(t,"class","form-control"),$(t,"slot","right")},m(r,n){b(r,t,n),A(t,c[1].end),e||(s=B(t,"input",c[10]),e=!0)},p(r,n){n&2&&A(t,r[1].end)},d(r){r&&p(t),e=!1,s()}}}function It(c){let t,e,s,r,n,a;return t=new N({props:{title:"Trackers",$$slots:{right:[St]},$$scope:{ctx:c}}}),t.$on("click",c[4].selectTrackers),s=new N({props:{title:V.t("general.start","Start"),$$slots:{right:[Tt]},$$scope:{ctx:c}}}),n=new N({props:{title:V.t("general.end","End"),$$slots:{right:[Et]},$$scope:{ctx:c}}}),{c(){D(t.$$.fragment),e=I(),D(s.$$.fragment),r=I(),D(n.$$.fragment)},l(l){w(t.$$.fragment,l),e=M(l),w(s.$$.fragment,l),r=M(l),w(n.$$.fragment,l)},m(l,o){Y(t,l,o),b(l,e,o),Y(s,l,o),b(l,r,o),Y(n,l,o),a=!0},p(l,o){const f={};o&16394&&(f.$$scope={dirty:o,ctx:l}),t.$set(f);const i={};o&16386&&(i.$$scope={dirty:o,ctx:l}),s.$set(i);const u={};o&16386&&(u.$$scope={dirty:o,ctx:l}),n.$set(u)},i(l){a||(h(t.$$.fragment,l),h(s.$$.fragment,l),h(n.$$.fragment,l),a=!0)},o(l){g(t.$$.fragment,l),g(s.$$.fragment,l),g(n.$$.fragment,l),a=!1},d(l){y(t,l),l&&p(e),y(s,l),l&&p(r),y(n,l)}}}function Mt(c){let t,e,s;return e=new dt({props:{name:"download"}}),{c(){t=v("div"),D(e.$$.fragment),this.h()},l(r){t=k(r,"DIV",{slot:!0,class:!0});var n=S(t);w(e.$$.fragment,n),n.forEach(p),this.h()},h(){$(t,"slot","right"),$(t,"class","fcenter")},m(r,n){b(r,t,n),Y(e,t,null),s=!0},p:L,i(r){s||(h(e.$$.fragment,r),s=!0)},o(r){g(e.$$.fragment,r),s=!1},d(r){r&&p(t),y(e)}}}function Vt(c){let t,e,s,r;const n=[kt,vt],a=[];function l(o,f){return o[0]=="csv"?0:1}return t=l(c),e=a[t]=n[t](c),{c(){e.c(),s=j()},l(o){e.l(o),s=j()},m(o,f){a[t].m(o,f),b(o,s,f),r=!0},p(o,f){let i=t;t=l(o),t===i?a[t].p(o,f):(tt(),g(a[i],1,1,()=>{a[i]=null}),et(),e=a[t],e?e.p(o,f):(e=a[t]=n[t](o),e.c()),h(e,1),e.m(s.parentNode,s))},i(o){r||(h(e),r=!0)},o(o){g(e),r=!1},d(o){a[t].d(o),o&&p(s)}}}function xt(c){let t,e,s,r,n,a,l,o,f;return s=new ut({}),{c(){t=v("div"),e=v("div"),D(s.$$.fragment),r=I(),n=v("div"),a=x("Export"),l=I(),o=v("div"),this.h()},l(i){t=k(i,"DIV",{class:!0,slot:!0});var u=S(t);e=k(u,"DIV",{class:!0});var m=S(e);w(s.$$.fragment,m),m.forEach(p),r=M(u),n=k(u,"DIV",{class:!0});var T=S(n);a=C(T,"Export"),T.forEach(p),l=M(u),o=k(u,"DIV",{class:!0}),S(o).forEach(p),u.forEach(p),this.h()},h(){$(e,"class","left"),$(n,"class","title main"),$(o,"class","right"),$(t,"class","n-toolbar-grid "),$(t,"slot","header")},m(i,u){b(i,t,u),d(t,e),Y(s,e,null),d(t,r),d(t,n),d(n,a),d(t,l),d(t,o),f=!0},i(i){f||(h(s.$$.fragment,i),f=!0)},o(i){g(s.$$.fragment,i),f=!1},d(i){i&&p(t),y(s)}}}function Ct(c){let t,e,s,r,n,a,l,o,f,i;return{c(){t=v("div"),e=v("button"),s=x("Backup"),n=I(),a=v("button"),l=x("CSV"),this.h()},l(u){t=k(u,"DIV",{class:!0,slot:!0});var m=S(t);e=k(m,"BUTTON",{class:!0});var T=S(e);s=C(T,"Backup"),T.forEach(p),n=M(m),a=k(m,"BUTTON",{class:!0});var _=S(a);l=C(_,"CSV"),_.forEach(p),m.forEach(p),this.h()},h(){$(e,"class",r="btn btn-sm "+(c[0]=="backup"?"active":"")),$(a,"class",o="btn btn-sm "+(c[0]=="csv"?"active":"")),$(t,"class","btn-group w-100"),$(t,"slot","sub-header")},m(u,m){b(u,t,m),d(t,e),d(e,s),d(t,n),d(t,a),d(a,l),f||(i=[B(e,"click",c[7]),B(a,"click",c[8])],f=!0)},p(u,m){m&1&&r!==(r="btn btn-sm "+(u[0]=="backup"?"active":""))&&$(e,"class",r),m&1&&o!==(o="btn btn-sm "+(u[0]=="csv"?"active":""))&&$(a,"class",o)},d(u){u&&p(t),f=!1,rt(i)}}}function Nt(c){let t,e;return t=new it({props:{pageTitle:"Export your Data",className:"Export",$$slots:{"sub-header":[Ct],header:[xt],default:[Vt]},$$scope:{ctx:c}}}),{c(){D(t.$$.fragment)},l(s){w(t.$$.fragment,s)},m(s,r){Y(t,s,r),e=!0},p(s,[r]){const n={};r&16399&&(n.$$scope={dirty:r,ctx:s}),t.$set(n)},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){g(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function Ot(c,t,e){let s;W(c,Z,_=>e(3,s=_));let{type:r="backup"}=t,n=!1,a={trackers:Z.getAsArray(),start:E().subtract(1,"month").format("YYYY-MM-DD"),end:E().format("YYYY-MM-DD")},l,o;const f={exportCSV(){return O(this,null,function*(){e(2,n=!0),U.blocker("Generating..."),yield F(120);let _=new ht,X=l.toDate(),K=o.toDate(),R=a.trackers;yield _.generate({trackers:R,start:X,end:K}),yield F(120),U.stopBlocker()})},selectTrackers(){U.selectTrackers().then(_=>{e(1,a.trackers=_,a)})},export(){_t()}};G(()=>{});const i=()=>{e(0,r="backup")},u=()=>{e(0,r="csv")};function m(){a.start=this.value,e(1,a)}function T(){a.end=this.value,e(1,a)}return c.$$set=_=>{"type"in _&&e(0,r=_.type)},c.$$.update=()=>{c.$$.dirty&34&&a.start&&E(a.start,"YYYY-MM-DD")!==l&&e(5,l=E(a.start,"YYYY-MM-DD")),c.$$.dirty&66&&a.end&&E(a.end,"YYYY-MM-DD")!==o&&e(6,o=E(a.end,"YYYY-MM-DD"))},[r,a,n,s,f,l,o,i,u,m,T]}class Ut extends z{constructor(t){super();P(this,t,Ot,Nt,q,{type:0})}}export{Ut as default};
